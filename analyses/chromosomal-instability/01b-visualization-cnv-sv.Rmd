---
title: "Circos Plots Examples for Visualizing SV and CNV data"
output:   
  html_notebook: 
    toc: true
    toc_float: true
author: Candace Savonen for ALSF - CCDL
date: 2020
---

This notebook shows examples of how to use the circos_map_plot function for 
mapping data that corresponds to chromosomal coordinates.

### Usage

This notebook can be run via the command line from the top directory of the 
repository as follows:

```
Rscript -e "rmarkdown::render('analyses/chromosomal-instability/01b-visulization-cnv-sv.Rmd', 
                              clean = TRUE)"
```

### Set Up

```{r}
# Set seed so heatmaps turn out the same
set.seed(2020)

# Magrittr pipe
`%>%` <- dplyr::`%>%`
```

Read in the custom functions needed for this analysis. 

```{r}
source(file.path("util", "circos-plots.R"))
```

### Directories and Files

```{r}
# Path to data directory
data_dir <- file.path("..", "..", "data")
scratch_dir <- file.path("..", "..", "scratch")

# Path to output directory
plots_dir <- "plots"

# Path to tumor type plots output directory
hist_plots_dir <- file.path(plots_dir, "tumor-type")

# Create the hist_plots_dir  if it does not exist
if (!dir.exists(hist_plots_dir)) {
  dir.create(hist_plots_dir, recursive = TRUE)
}
```

### Read in data 

Set up metadata

```{r}
# Read in the metadata
metadata <- readr::read_tsv(file.path(data_dir, "pbta-histologies.tsv"))
```

Load in the previously formatted breakpoint data. 

```{r}
breaks_list <- readr::read_rds(file.path("breakpoint-data", "breaks_lists.RDS"))
```

Read in the CNV and SV data. 

```{r}
cnv_df <- data.table::fread(
  file.path(data_dir, "pbta-cnv-cnvkit.seg.gz"), data.table = FALSE) 

sv_df <- data.table::fread(
  file.path(data_dir, "pbta-sv-manta.tsv.gz"), data.table = FALSE) 
```

```{r}
sample_df <- readr::read_tsv(file.path(scratch_dir, "sv-vcf", "BS_0DKPGQWD_withoutYandM.tsv"))

bed_1 <- sample_df %>% 
  dplyr::select(chrom = chrom1, start = pos1, end = pos2) %>% 
  dplyr::mutate(chrom = paste0("chr", chrom), 
                start = as.integer(start), 
                end = as.integer(end), 
                value1 = rnorm(nrow(sample_df)))

bed_2 <- sample_df %>% 
  dplyr::select(chrom = chrom2, start = pos1, end = pos2) %>% 
  dplyr::mutate(chrom = paste0("chr", chrom), 
                start = as.integer(start), 
                end = as.integer(end),
                value1 = rnorm(nrow(sample_df)))
```


```{r}
circos_map_plot(df = breaks_list$sv_breaks,
                add_track = FALSE,
                samples_col = "samples",
                sample_names = "all",
                chr_col = "chrom",
                start_col = "coord",
                end_col =  "coord",
                y_val = NULL,
                track_height = .15,
                type = "rect",
                colour_key = "svclass", 
                palette = "YlGnBu") 
```

### Session Info

```{r}
sessionInfo()
```

