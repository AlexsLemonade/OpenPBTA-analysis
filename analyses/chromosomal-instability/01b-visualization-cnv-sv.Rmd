---
title: "Visualize SV and CNV data"
output:   
  html_notebook: 
    toc: true
    toc_float: true
author: Candace Savonen for ALSF - CCDL
date: 2020
---

To generate circular plots that integrate CNV and SV data. Specifically, it might be useful for the following cases:

Display examples of chromothripsis per #27 (comment)
There are some subtype tickets that would benefit from such a visualization (e.g., "[ST-EPN-YAP1] Focal 11q most frequent CNA, with rest of genome stable" #245)
Likely most useful to examine translocations
The implementation should focus on flexibility and extensibility because we don't know what "final" output will be required for the project.
### Usage

This notebook can be run via the command line from the top directory of the 
repository as follows:

```
Rscript -e "rmarkdown::render('analyses/chromosomal-instability/01-plot-chromosomal-instability.Rmd', 
                              clean = TRUE)"
```

### Set Up

```{r}
# Set seed so heatmaps turn out the same
set.seed(2020)

# Magrittr pipe
`%>%` <- dplyr::`%>%`
```

Read in the custom functions needed for this analysis. 

```{r}
source(file.path("util", "circos-plots.R"))
```

### Directories and Files

```{r}
# Path to data directory
data_dir <- file.path("..", "..", "data")
scratch_dir <- file.path("..", "..", "scratch")

# Path to output directory
plots_dir <- "plots"

# Path to tumor type plots output directory
hist_plots_dir <- file.path(plots_dir, "tumor-type")

# Create the hist_plots_dir  if it does not exist
if (!dir.exists(hist_plots_dir)) {
  dir.create(hist_plots_dir, recursive = TRUE)
}
```

### Read in data 

Set up metadata

```{r}
# Read in the metadata
metadata <- readr::read_tsv(file.path(data_dir, "pbta-histologies.tsv"))
```

Read in the union breaks densities TSV that was made by the 00-setup-breakpoint-data.R script. 

```{r}
breaks_densities_df <- readr::read_tsv(
  file.path("breakpoint-data", "union_of_breaks_densities.tsv")) %>% 
  # Add on the short histology column from the metadata for plotting purposes
  dplyr::inner_join(metadata %>% dplyr::select(Kids_First_Biospecimen_ID, short_histology), 
                    by = c("samples" = "Kids_First_Biospecimen_ID"))
```

Load in the previously formatted breakpoint data. 

```{r}
breaks_list <- readr::read_rds(file.path("breakpoint-data", "breaks_lists.RDS"))
```

Get a vector of the biospecimen IDs. 

```{r}
cnv_df <- data.table::fread(
  file.path(data_dir, "pbta-cnv-cnvkit.seg.gz"), data.table = FALSE) 

sv_df <- data.table::fread(
  file.path(data_dir, "pbta-sv-manta.tsv.gz"), data.table = FALSE) 
```

### Session Info

```{r}
sessionInfo()
```

