---
title: "Segment to gene mapping in ATRT"
output: html_notebook
author: J. Taroni for ALSF CCDL
date: 2019
---

From [this comment](https://github.com/AlexsLemonade/OpenPBTA-analysis/pull/182#discussion_r340587968) on #182:

> may advise starting with ATRT's and SMARCB1 deletions

Here, I'm looking at the output of `01-prepare-cn-file.R` to see if we recover that information in the segment to gene mapping.
We're going to get the data from a pull request/branch that is currently open.
This will get whatever the current files are for that branch.

```{sh}
wget --quiet -N -P results https://raw.githubusercontent.com/jaclyn-taroni/OpenPBTA-analysis/186-both-formats/analyses/focal-cn-file-preparation/results/cnvkit_annotated_cn_autosomes.tsv.gz
wget --quiet -N -P results https://raw.githubusercontent.com/jaclyn-taroni/OpenPBTA-analysis/186-both-formats/analyses/focal-cn-file-preparation/results/controlfreec_annotated_cn_autosomes.tsv.gz 
```

```{r}
`%>%` <- dplyr::`%>%`
```

### Read in data

```{r}
# read in the output of `01-prepare-cn-file.R`
cnvkit_df <- readr::read_tsv(file.path("results", 
                                       "cnvkit_annotated_cn_autosomes.tsv.gz"))
controlfreec_df <- readr::read_tsv(file.path("results",
                                             "controlfreec_annotated_cn_autosomes.tsv.gz"))
# read in the clinical file that has the disease type information
histologies_df <- readr::read_tsv(file.path("..", "..", "data", 
                                            "pbta-histologies.tsv"))
```

### Look at copy number information for ATRT

```{r}
# get ATRT biospecimen identifiers
atrt_specimens <- histologies_df %>%
  dplyr::filter(disease_type_new == "Atypical Teratoid Rhabdoid Tumor") %>%
  dplyr::pull(Kids_First_Biospecimen_ID)
```

#### CNVkit

```{r}
# filter the gene-level CN information to ATRT samples and gene symbols
# containing 'SMARC'
cnvkit_atrt <- cnvkit_df %>%
  dplyr::filter(biospecimen_id %in% atrt_specimens,
                grepl("SMARCB1", gene_symbol))
cnvkit_atrt
```

```{r}
table(cnvkit_atrt$status)
```

#### ControlFreeC

```{r}
controlfreec_atrt <- controlfreec_df %>%
  dplyr::filter(biospecimen_id %in% atrt_specimens,
                grepl("SMARCB1", gene_symbol))
controlfreec_atrt
```

```{r}
table(controlfreec_atrt$status)
```

#### Cursory comparison

Find the one sample that reports a `gain` in ControlFreeC and look at that sample in CNVkit.

```{r}
controlfreec_gain_sample <- controlfreec_atrt %>%
  dplyr::filter(status == "gain") %>%
  dplyr::pull(biospecimen_id)

cnvkit_atrt %>% dplyr::filter(biospecimen_id == controlfreec_gain_sample)
```

CNVkit marks this as a loss.

Check which samples are in both.

```{r}
intersect(controlfreec_atrt$biospecimen_id, cnvkit_atrt$biospecimen_id)
```

```{r}
length(unique(cnvkit_atrt$biospecimen_id))
```

```{r}
length(unique(controlfreec_atrt$biospecimen_id))
```
