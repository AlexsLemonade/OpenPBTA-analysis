---
title: "Find most focal copy number units"
output: 
  html_notebook:
    toc: TRUE
    toc_float: TRUE
author: Chante Bethell for ALSF CCDL
date: 2020
---

This notebook defines the most focal recurrent copy number units by separating out entire chromsome arm losses and gains.

## Usage

This notebook is intended to be run from the command line with the following (assumes you are in the root directory of the repository):

```
Rscript -e "rmarkdown::render('analyses/focal-cn-file-preparation/05-define-most-focal-cn-units.Rmd', clean = TRUE)"
```

## Set up

### Libraries and functions

```{r}
library(tidyverse)
```

### Files and directories

```{r}
results_dir <- "results"
```

### Read in files

```{r}
consensus_seg_cytoband_status_df <-
  read_tsv(file.path("results", "consensus_seg_with_ucsc_cytoband.tsv.gz"))

consensus_seg_autosomes_df <-
  read_tsv(file.path(results_dir, "consensus_seg_annotated_cn_autosomes.tsv.gz"))
```

## Define most focal units

We will filter out entire chromsome arm losses or gains.

```{r}
consensus_seg_cytoband_status_df <- consensus_seg_cytoband_status_df %>%
  select(chromosome_arm, cytoband, Kids_First_Biospecimen_ID, dominant_status) %>%
  # We don't want to keep entire chromosome arm losses/gains or uncallable
  # regions
  filter(dominant_status == "neutral")

# Note: this step crashes locally as is
consensus_seg_autosomes_df <- consensus_seg_autosomes_df %>%
  # By using inner join here, we are keeping the sample calls that do not fall
  # chromsome arms that have been called as a loss or gain -- we will also
  # replace the cytoband values here with the UCSC cytoband values
  right_join(
    consensus_seg_cytoband_status_df,
    by = c("biospecimen_id" = "Kids_First_Biospecimen_ID")
  )
```

## Session Info

```{r}
sessionInfo()
```

